<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numeric Duel - Browser Game</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <!-- Menu Screen -->
        <div id="menu-screen" class="screen active">
            <div class="menu-content">
                <div class="language-selector">
                    <button class="lang-btn" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="ru">RU</button>
                </div>

                <h1 class="game-title">‚öîÔ∏è NUMERIC DUEL</h1>
                <p class="game-subtitle">To the last soldier!</p>

                <div class="nickname-input-container">
                    <input type="text" id="nickname-input" class="nickname-input" placeholder="Enter your nickname"
                        maxlength="20">
                    <div id="nickname-status" class="nickname-status"></div>
                </div>

                <div class="menu-buttons">
                    <button class="btn btn-primary" id="start-btn">Start Game (vs AI)</button>
                    <button class="btn btn-primary" id="multiplayer-btn">Multiplayer</button>
                    <button class="btn btn-secondary" id="leaderboard-btn">Leaderboard</button>
                    <button class="btn btn-secondary" id="rules-btn">Rules</button>
                </div>

                <div class="mini-leaderboard">
                    <h3 style="margin: 20px 0 10px; color: var(--warning-color);">üèÜ TOP PLAYERS</h3>
                    <div id="mini-leaderboard-list" class="mini-leaderboard-list">
                        <!-- Top players will be added via JS -->
                    </div>
                </div>

                <!-- Chat -->
                <div class="chat-container">
                    <div class="chat-header">
                        <h3>üí¨ Global Chat</h3>
                        <button class="btn-chat-toggle" id="chat-toggle">‚àí</button>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="chat-message system">Welcome to Numeric Duel! Chat with other players.</div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" class="chat-input" placeholder="Type a message..."
                            maxlength="200">
                        <button class="btn btn-primary btn-send" id="chat-send">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Selection Screen -->
        <div id="selection-screen" class="screen">
            <div class="selection-content">
                <h2>Select Troops</h2>
                <p class="hint">Choose numbers for your army. Each number is a unit with a troop type</p>

                <div class="number-grid" id="number-grid">
                    <!-- Numbers will be added via JS -->
                </div>

                <div class="selected-display">
                    <h3>Your Army:</h3>
                    <div class="selected-numbers" id="selected-numbers"></div>
                    <p class="hint-small">Click the number again to deselect</p>
                </div>

                <button class="btn btn-primary" id="ready-btn" disabled>To Battle!</button>
            </div>
        </div>

        <!-- Flank Setup Screen -->
        <div id="flank-setup-screen" class="screen">
            <div class="flank-content">
                <h2 id="round-title">Turn 1</h2>
                <p class="hint">Place troops on flanks</p>

                <div class="flank-battlefield">
                    <!-- Your flanks -->
                    <div class="flank-player" id="your-flanks">
                        <h3><span id="your-nickname-display" class="player-nickname">Your Troops</span></h3>

                        <div class="flank-slots">
                            <div class="flank-slot flank-left">
                                <div class="flank-label">Left</div>
                                <!-- Unit will appear here -->
                            </div>
                            <div class="flank-slot flank-center">
                                <div class="flank-label">Center</div>
                            </div>
                            <div class="flank-slot flank-right">
                                <div class="flank-label">Right</div>
                            </div>
                        </div>

                        <div class="available-numbers">
                            <!-- Available units -->
                        </div>

                        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                            <button class="btn btn-primary start-battle-btn" id="flank-ready-btn">Start Battle!</button>
                            <button class="btn btn-danger surrender-btn" id="surrender-btn">üè≥Ô∏è Surrender</button>
                        </div>
                    </div>

                    <!-- Enemy flanks -->
                    <div class="flank-player" id="enemy-flanks">
                        <h3><span id="enemy-nickname-display" class="player-nickname">Enemy</span></h3>

                        <div class="flank-slots">
                            <div class="flank-slot flank-left">
                                <div class="flank-label">Left</div>
                            </div>
                            <div class="flank-slot flank-center">
                                <div class="flank-label">Center</div>
                            </div>
                            <div class="flank-slot flank-right">
                                <div class="flank-label">Right</div>
                            </div>
                        </div>

                        <div class="available-numbers">
                            <!-- Enemy available units (hidden) -->
                        </div>
                    </div>
                </div>

                <!-- Advantages reminder -->
                <div class="advantages-reminder">
                    <div class="advantage-item">
                        <span class="advantage-icon">‚öîÔ∏è</span>
                        <span class="advantage-arrow">‚Üí</span>
                        <span class="advantage-icon">üê¥</span>
                    </div>
                    <div class="advantage-item">
                        <span class="advantage-icon">üèπ</span>
                        <span class="advantage-arrow">‚Üí</span>
                        <span class="advantage-icon">‚öîÔ∏è</span>
                    </div>
                    <div class="advantage-item">
                        <span class="advantage-icon">üê¥</span>
                        <span class="advantage-arrow">‚Üí</span>
                        <span class="advantage-icon">üèπ</span>
                    </div>
                </div>

                <div class="battle-log" id="battle-log">
                    <div class="log-entry">Preparing for battle...</div>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="screen">
            <div class="result-content">
                <div class="result-icon" id="result-icon">üèÜ</div>
                <h2 id="result-title">Victory!</h2>
                <p id="result-message">You won this duel</p>
                <div class="result-buttons">
                    <button class="btn btn-primary" id="play-again-btn">Play Again</button>
                    <button class="btn btn-secondary" id="menu-btn">Main Menu</button>
                </div>
            </div>
        </div>

        <!-- Leaderboard Screen -->
        <div id="leaderboard-screen" class="screen">
            <div class="menu-content">
                <h1 class="game-title">üèÜ LEADERBOARD</h1>

                <div id="player-position" class="player-position">
                    <!-- Player's position will be added via JS -->
                </div>

                <div id="leaderboard-content" class="leaderboard-content">
                    <div class="leaderboard-header">
                        <span class="rank-header">#</span>
                        <span class="name-header">Nickname</span>
                        <span class="stats-header">Rating</span>
                        <span class="stats-header">Wins</span>
                        <span class="stats-header">Losses</span>
                    </div>
                    <div id="leaderboard-list" class="leaderboard-list">
                        <!-- Leaders will be added via JS -->
                    </div>
                </div>
                <button class="btn btn-secondary" id="leaderboard-back-btn">Back</button>
            </div>
        </div>

        <!-- Multiplayer Screen (Lobby) -->
        <div id="multiplayer-screen" class="screen">
            <div class="menu-content">
                <h1 class="game-title">üåê MULTIPLAYER</h1>
                <div id="lobby-status" class="lobby-status">
                    <p>Click "Find Match" for quick match</p>
                </div>
                <div id="room-info" class="room-info" style="display: none;">
                    <h3>Room: <span id="room-id-display"></span></h3>
                    <p>Players: <span id="players-count">1</span>/2</p>
                </div>
                <button class="btn btn-primary" id="find-match-btn">Find Match</button>
                <button class="btn btn-secondary" id="back-to-menu-btn">Back</button>
            </div>
        </div>

        <!-- Rules Modal -->
        <div id="rules-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Game Rules</h2>
                <div class="rules-content">
                    <h3>Goal</h3>
                    <p>Destroy all enemy troops!</p>

                    <h3>Unit Types</h3>
                    <ul class="rules-list">
                        <li><strong>‚öîÔ∏è Warriors</strong> - strong against üê¥ Cavalry</li>
                        <li><strong>üèπ Archers</strong> - strong against ‚öîÔ∏è Warriors</li>
                        <li><strong>üê¥ Cavalry</strong> - strong against üèπ Archers</li>
                    </ul>

                    <h3>Combat Mechanics</h3>
                    <ul class="rules-list">
                        <li>Number = dice rolls (0 to 1)</li>
                        <li>All rolls sum = damage</li>
                        <li><strong>Advantage:</strong> damage √ó 1.5</li>
                        <li><strong>Equal:</strong> damage √ó 1.0</li>
                        <li><strong>Weakness:</strong> damage √ó 0.5</li>
                        <li>After combat, subtract damage from number</li>
                        <li>Number = 0? Unit destroyed!</li>
                    </ul>

                    <h3>Flanks</h3>
                    <p>Your left flank hits enemy left, center hits center, right hits enemy right.</p>

                    <h3>Victory</h3>
                    <p>The one who destroyed all enemy units wins!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Yandex Games SDK -->
    <script src="https://yandex.ru/games/sdk/v2"></script>
    <!-- Socket.io: —É–º–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ - –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –¥–ª—è –Ø–Ω–¥–µ–∫—Å –ò–≥—Ä, CDN –¥–ª—è –¥—Ä—É–≥–∏—Ö -->
    <script>
        (function () {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–∞ –ª–∏ –∏–≥—Ä–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å –ò–≥—Ä–∞—Ö
            var isYandexGames = typeof YaGames !== 'undefined' ||
                window.location.hostname.includes('yandex') ||
                window.location.hostname.includes('games');

            var socketScript = document.createElement('script');
            socketScript.src = isYandexGames ? 'socket.io.min.js' : 'https://cdn.socket.io/4.5.4/socket.io.min.js';
            socketScript.async = false; // –í–∞–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–µ—Ä–µ–¥ game.js
            document.head.appendChild(socketScript);
        })();
    </script>
    <script src="i18n.js"></script>
    <script src="game.js"></script>
</body>

</html>